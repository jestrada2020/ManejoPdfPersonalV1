<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramientas PDF Avanzadas</title>
    <link rel="stylesheet" href="CSS/styles.css">
</head>

<body>
    <div class="app">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>Herramientas PDF Profesional</h1>
            </div>
            <div class="tabs">
                <button class="tab-btn active" data-tab="merge" onclick="switchTab('merge')">Unir PDFs</button>
                <button class="tab-btn" data-tab="extract" onclick="switchTab('extract')">Extraer por Rango</button>
                <button class="tab-btn" data-tab="search" onclick="switchTab('search')">Extraer por B√∫squeda</button>
                <button class="tab-btn" data-tab="chapters" onclick="switchTab('chapters')">Extracci√≥n de Cap√≠tulos</button>
                <button class="tab-btn" data-tab="unlock" onclick="switchTab('unlock')">Desbloquear PDF</button>
                <button class="tab-btn" data-tab="annotate" onclick="switchTab('annotate')">Anotar / Revisar</button>
                <button class="tab-btn" data-tab="media" onclick="switchTab('media')">A√±adir Videos / Audio</button>
                <button class="tab-btn" data-tab="translate" onclick="switchTab('translate')">Traductor / Lector</button>
                <button class="tab-btn" data-tab="translate-en-es" onclick="switchTab('translate-en-es')">Traduccion de textos de Ingles A Espa√±ol</button>
                <button class="tab-btn" data-tab="translate-es-en" onclick="switchTab('translate-es-en')">Espa√±ol A Ingles</button>
                <button class="tab-btn" data-tab="podcast" onclick="switchTab('podcast')">Podcast</button>
                <button class="tab-btn" data-tab="tts-podcast" onclick="switchTab('tts-podcast')">Texto a Podcast</button>
            </div>
        </aside>

        <main class="content">
            <!-- MERGE TAB -->
            <div id="merge" class="tab-content active">
                <div class="form-group">
                    <label>1. Seleccionar Archivos (Ordenados)</label>
                    <input type="file" id="mergeFilesInput" accept="application/pdf" multiple style="margin-bottom: 10px;">
                    <ul id="mergeList" class="file-list"></ul>
                    <p class="logs" id="mergeLogs">A√±ade archivos para comenzar.</p>
                </div>

                <div class="form-group">
                    <label>2. Nombre del archivo final</label>
                    <input type="text" id="mergeOutputName" placeholder="pdf_unido.pdf" value="pdf_unido.pdf">
                </div>

                <button id="mergeBtn" class="btn" disabled onclick="mergePDFs()">Unir PDFs Seleccionados</button>

                <div id="mergeResult" class="result-area">
                    ¬°√âxito! <a id="mergeDownload" href="#" download>Descargar PDF Unido</a>
                </div>
            </div>

            <!-- EXTRACT TAB -->
            <div id="extract" class="tab-content">
                <div class="form-group upload-box">
                    <label style="font-size: 1.1rem; margin-bottom: 10px; display:block;">1. Seleccionar Archivo PDF</label>

                    <input type="file" id="extractFileInput" accept="application/pdf" style="display: none;"
                        onchange="handleSingleFileSelect('extract')">
                    <button class="btn center-btn" onclick="document.getElementById('extractFileInput').click()">
                        üìÇ Cargar PDF (Extraer)
                    </button>

                    <div id="extractFileInfo" class="file-info-box">
                        <span id="extractFileName" style="font-weight:bold;"></span>
                        <div style="margin-top: 8px;">
                            <input type="password" id="extractFilePass" placeholder="Contrase√±a (si tiene)">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>P√°gina Inicio</label>
                            <input type="number" id="startPage" min="1" value="1">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>P√°gina Final</label>
                            <input type="number" id="endPage" min="1" value="1">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="rasterizeMode" style="width:auto; margin-right:10px;">
                        <span>Modo Compatibilidad (Imprimir como Imagen)</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        √öselo si recibe errores de contrase√±a o si el archivo est√° protegido. Esto convertir√° las p√°ginas en
                        im√°genes.
                    </small>
                </div>

                <div class="form-group">
                    <label>Nombre del archivo final</label>
                    <input type="text" id="extractOutputName" placeholder="paginas_extraidas.pdf"
                        value="paginas_extraidas.pdf">
                </div>

                <button id="extractBtn" class="btn" disabled onclick="extractPages()">Extraer P√°ginas</button>

                <div id="extractResult" class="result-area">
                    ¬°√âxito! <a id="extractDownload" href="#" download>Descargar PDF Extra√≠do</a>
                </div>
            </div>

            <!-- SEARCH TAB -->
            <div id="search" class="tab-content">
                <div class="form-group upload-box">
                    <label style="font-size: 1.1rem; margin-bottom: 10px; display:block;">1. Seleccionar Archivo PDF</label>

                    <input type="file" id="searchFileInput" accept="application/pdf" style="display: none;"
                        onchange="handleSingleFileSelect('search')">
                    <button class="btn center-btn" onclick="document.getElementById('searchFileInput').click()">
                        üìÇ Cargar PDF (B√∫squeda)
                    </button>

                    <div id="searchFileInfo" class="file-info-box">
                        <span id="searchFileName" style="font-weight:bold;"></span>
                        <div style="margin-top: 8px;">
                            <input type="password" id="searchFilePass" placeholder="Contrase√±a (si tiene)">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>2. Texto a buscar</label>
                    <input type="text" id="searchQuery" placeholder="Ej: Cap√≠tulo 1, Referencia #123...">
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        La b√∫squeda es inteligente: no distingue may√∫sculas/min√∫sculas ni acentos.
                    </small>
                </div>

                <div class="form-group">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="searchRasterMode" style="width:auto; margin-right:10px;">
                        <span>Modo Compatibilidad (Imprimir como Imagen)</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        √öselo si recibe errores o si el archivo est√° protegido. Esto convertir√° las p√°ginas en im√°genes.
                    </small>
                </div>

                <div class="form-group">
                    <label>Nombre del archivo final</label>
                    <input type="text" id="searchOutputName" placeholder="busqueda_resultado.pdf"
                        value="busqueda_resultado.pdf">
                </div>

                <button id="searchBtn" class="btn" disabled onclick="searchAndExtract()">Buscar P√°ginas</button>
                <p class="logs" id="searchLogs"></p>

                <div id="searchPreview" class="preview-box">
                    <h3 style="margin-top: 0; font-size: 1.1rem; color: var(--text-main);">P√°ginas encontradas:</h3>
                    <div id="searchPagesList" style="margin-bottom: 15px; max-height: 200px; overflow-y: auto;"></div>
                    <button id="extractFoundBtn" class="btn" onclick="extractFoundPages()" style="margin-right: 10px;">
                        Extraer P√°ginas Seleccionadas
                    </button>
                    <button class="btn" onclick="cancelSearch()" style="background: #6b7280;">
                        Cancelar
                    </button>
                </div>

                <div id="searchResult" class="result-area">
                    ¬°√âxito! <a id="searchDownload" href="#" download>Descargar PDF Resultante</a>
                </div>
            </div>

            <!-- CHAPTERS TAB -->
            <div id="chapters" class="tab-content">
                <div class="form-group upload-box">
                    <label style="font-size: 1.1rem; margin-bottom: 10px; display:block;">1. Seleccionar Archivo PDF</label>

                    <input type="file" id="chaptersFileInput" accept="application/pdf" style="display: none;"
                        onchange="handleSingleFileSelect('chapters')">
                    <button class="btn center-btn" onclick="document.getElementById('chaptersFileInput').click()">
                        üìÇ Cargar PDF (Cap√≠tulos)
                    </button>

                    <div id="chaptersFileInfo" class="file-info-box">
                        <span id="chaptersFileName" style="font-weight:bold;"></span>
                        <div style="margin-top: 8px;">
                            <input type="password" id="chaptersFilePass" placeholder="Contrase√±a (si tiene)">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>2. Patr√≥n de detecci√≥n de cap√≠tulos</label>
                    <input type="text" id="chapterPattern" placeholder='Ej: Cap√≠tulo, Chapter, CAP√çTULO'
                        value="Cap√≠tulo,Chapter,CAP√çTULO">
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        Ingrese las palabras clave separadas por comas. El sistema detectar√° cap√≠tulos autom√°ticamente.
                    </small>
                </div>

                <div class="form-group">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="chapterUseNumbers" checked style="width:auto; margin-right:10px;">
                        <span>Detectar solo cap√≠tulos numerados (Cap√≠tulo 1, Cap√≠tulo 2, etc.)</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        Recomendado para evitar falsos positivos. Desmarque para detectar todos los cap√≠tulos.
                    </small>
                </div>

                <div class="form-group">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="chapterRasterMode" style="width:auto; margin-right:10px;">
                        <span>Modo Compatibilidad (Imprimir como Imagen)</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        √öselo si recibe errores o si el archivo est√° protegido.
                    </small>
                </div>

                <button id="chaptersBtn" class="btn" disabled onclick="detectChapters()">Detectar Cap√≠tulos</button>
                <p class="logs" id="chaptersLogs"></p>

                <div id="chaptersPreview" class="preview-box">
                    <h3 style="margin-top: 0; font-size: 1.1rem; color: var(--text-main);">Cap√≠tulos detectados:</h3>
                    <div id="chaptersList" style="margin-bottom: 15px; max-height: 300px; overflow-y: auto;"></div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button id="extractAllChaptersBtn" class="btn" onclick="extractAllChapters()">
                            üìö Extraer Todos los Cap√≠tulos
                        </button>
                        <button class="btn" onclick="cancelChapters()" style="background: #6b7280;">
                            Cancelar
                        </button>
                    </div>
                </div>

                <div id="chaptersResult" class="result-area">
                    <p id="chaptersResultText">¬°√âxito! Se han generado los cap√≠tulos.</p>
                    <div id="chaptersDownloadLinks" style="margin-top: 10px;"></div>
                </div>
            </div>

            <!-- UNLOCK TAB -->
            <div id="unlock" class="tab-content">
                <div class="form-group upload-box">
                    <label style="font-size: 1.1rem; margin-bottom: 10px; display:block;">1. Seleccionar Archivo
                        Protegido</label>

                    <input type="file" id="unlockFileInput" accept="application/pdf" style="display: none;"
                        onchange="handleSingleFileSelect('unlock')">
                    <button class="btn center-btn" onclick="document.getElementById('unlockFileInput').click()">
                        üîê Cargar PDF (Desbloquear)
                    </button>

                    <div id="unlockFileInfo" class="file-info-box">
                        <span id="unlockFileName" style="font-weight:bold;"></span>
                        <div style="margin-top: 8px;">
                            <input type="password" id="unlockFilePass" placeholder="Contrase√±a (opcional si no tiene)">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="unlockRasterMode" style="width:auto; margin-right:10px;">
                        <span>Modo Avanzado (Renderizar como Im√°genes)</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        Use este modo si el PDF tiene restricciones que no se pueden eliminar normalmente.
                        El archivo resultante ser√° m√°s grande pero estar√° completamente desbloqueado.
                        Este modo procesa en lotes para optimizar la memoria.
                    </small>
                </div>

                <div class="form-group">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="unlockLowMemoryMode" style="width:auto; margin-right:10px;">
                        <span>Modo Ahorro de Memoria (Para PDFs muy grandes)</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
                        Active esta opci√≥n si est√° procesando un PDF con muchas p√°ginas (>100).
                        El proceso ser√° m√°s lento pero usar√° menos memoria.
                    </small>
                </div>

                <div class="form-group">
                    <label>Nombre del archivo final (Desbloqueado)</label>
                    <input type="text" id="unlockOutputName" placeholder="archivo_desbloqueado.pdf"
                        value="archivo_desbloqueado.pdf">
                </div>

                <button id="unlockBtn" class="btn" disabled onclick="unlockPDF()">Desbloquear PDF</button>
                <p class="logs" id="unlockLogs"></p>

                <div id="unlockResult" class="result-area">
                    ¬°√âxito! <a id="unlockDownload" href="#" download>Descargar PDF Desbloqueado</a>
                </div>
            </div>

            <!-- ANNOTATE TAB -->
            <div id="annotate" class="tab-content">
                <div class="form-group upload-box">
                    <label style="font-size: 1.1rem; margin-bottom: 10px; display:block;">1. Seleccionar Archivo PDF</label>

                    <input type="file" id="annotateFileInput" accept="application/pdf" style="display: none;"
                        onchange="handleSingleFileSelect('annotate')">

                    <button class="btn center-btn" onclick="document.getElementById('annotateFileInput').click()">
                        üìÇ Cargar PDF (Anotar)
                    </button>

                    <div id="annotateFileInfo" class="file-info-box">
                        <span id="annotateFileName" style="font-weight:bold;"></span>
                    </div>
                </div>

                <button id="annotateBtn" class="btn" disabled onclick="startAnnotation()">
                    ‚úèÔ∏è Comenzar Revisi√≥n
                </button>

                <div id="annotateResult" class="result-area">
                    ¬°√âxito! <a id="annotateDownload" href="#" download>Descargar PDF Anotado</a>
                </div>
            </div>

            <!-- MEDIA TAB -->
            <div id="media" class="tab-content">
                <div class="form-group upload-box">
                    <label style="font-size: 1.1rem; margin-bottom: 10px; display:block;">1. Seleccionar Archivo PDF</label>

                    <input type="file" id="mediaFileInput" accept="application/pdf" style="display: none;"
                        onchange="handleSingleFileSelect('media')">

                    <button class="btn center-btn" onclick="document.getElementById('mediaFileInput').click()">
                        üìÇ Cargar PDF (Multimedia)
                    </button>

                    <div id="mediaFileInfo" class="file-info-box">
                        <span id="mediaFileName" style="font-weight:bold;"></span>
                    </div>
                </div>

                <button id="mediaBtn" class="btn" disabled onclick="startMediaAnnotation()">
                    üé¨ A√±adir Multimedia
                </button>

                <div id="mediaResult" class="result-area">
                    ¬°√âxito! <a id="mediaDownload" href="#" download>Descargar PDF Multimedia</a>
                </div>
            </div>

            <!-- TRANSLATE / READER TAB -->
            <div id="translate" class="tab-content full-height">
                <div class="side-layout">
                    <div class="sidebar-controls">
                        <h3>Traductor / Lector</h3>

                        <button class="btn" style="width:100%; margin-bottom:10px;"
                            onclick="document.getElementById('translateFileInput').click()">
                            üìÇ Cargar PDF
                        </button>
                        <input type="file" id="translateFileInput" accept="application/pdf" style="display: none;"
                            onchange="handleTranslateFileBase(this)">

                        <hr>

                        <label><b>Zoom / Vista:</b></label>
                        <div style="display:flex; gap:5px; margin-bottom: 10px;">
                            <button class="btn" style="flex:1; font-size: 0.8rem;" onclick="setTranslateZoom('fit')">Ajustar
                                Ancho</button>
                            <button class="btn" style="width: 30px;" onclick="changeTranslateZoom(0.2)">+</button>
                            <button class="btn" style="width: 30px;" onclick="changeTranslateZoom(-0.2)">-</button>
                        </div>

                        <label><b>1. Traducci√≥n</b></label>
                        <label>Idioma destino:</label>
                        <select id="transLang" class="form-control">
                            <option value="es">Espa√±ol</option>
                            <option value="en">Ingl√©s</option>
                            <option value="fr">Franc√©s</option>
                            <option value="de">Alem√°n</option>
                            <option value="it">Italiano</option>
                            <option value="pt">Portugu√©s</option>
                            <option value="zh-CN">Chino</option>
                            <option value="ja">Japon√©s</option>
                        </select>
                        <button class="btn" onclick="translateSelection()">Traducir Selecci√≥n</button>

                        <hr>

                        <label><b>2. Lectura (TTS)</b></label>
                        <label>Voz:</label>
                        <select id="ttsVoice" class="form-control" onchange="previewVoice()">
                            <option value="">Cargando voces...</option>
                        </select>

                        <label>Velocidad:</label>
                        <input type="range" id="ttsRate" min="0.5" max="2" step="0.1" value="1">

                        <div style="display:flex; gap:5px; margin-top:5px;">
                            <button class="btn" onclick="speakSelection()" style="flex:1;">‚ñ∂Ô∏è Leer</button>
                            <button class="btn" onclick="stopSpeech()" style="flex:1;">‚èπÔ∏è Parar</button>
                        </div>
                    </div>

                    <div class="viewer-wrap">
                        <div id="translateWrapper" style="position: relative;">
                            <canvas id="translateCanvas" style="display:block; border: 1px solid black;"></canvas>
                            <div id="textLayer" class="textLayer"></div>
                        </div>
                    </div>
                </div>

                <div class="floating-controls">
                    <button onclick="changeTranslatePage(-1)">‚èÆÔ∏è</button>
                    <span id="transPageLabel">1 / 1</span>
                    <button onclick="changeTranslatePage(1)">‚è≠Ô∏è</button>
                </div>
            </div>

            <!-- TRANSLATE EN -> ES TAB -->
            <div id="translate-en-es" class="tab-content full-height">
                <div class="side-layout">
                    <div class="sidebar-controls">
                        <h3>Ingles ‚Üí Espa√±ol</h3>

                        <button class="btn" style="width:100%; margin-bottom:10px;"
                            onclick="document.getElementById('enEsFileInput').click()">
                            üìÇ Cargar PDF
                        </button>
                        <input type="file" id="enEsFileInput" accept="application/pdf" style="display: none;"
                            onchange="handleEnEsFileBase(this)">

                        <hr>

                        <div style="display:flex; gap:5px; margin-bottom: 10px;">
                            <button class="btn" style="flex:1; font-size: 0.8rem;" onclick="setEnEsZoom('fit')">Ajustar
                                Ancho</button>
                            <button class="btn" style="width: 30px;" onclick="changeEnEsZoom(0.2)">+</button>
                            <button class="btn" style="width: 30px;" onclick="changeEnEsZoom(-0.2)">-</button>
                        </div>

                        <div style="display:flex; gap:5px; margin-bottom: 10px;">
                            <button class="btn" style="flex:1;" onclick="changeEnEsPage(-1)">‚èÆÔ∏è Pagina</button>
                            <button class="btn" style="flex:1;" onclick="changeEnEsPage(1)">Pagina ‚è≠Ô∏è</button>
                        </div>
                        <div id="enEsPageLabel" style="font-size: 0.85rem; color: var(--text-muted);">1 / 1</div>

                        <hr>

                        <button class="btn" onclick="runEnEsOcrCurrentPage()" style="background:#0f766e;">
                            üîé OCR esta pagina
                        </button>

                        <hr>

                        <label><b>Parrafos</b></label>
                        <div id="enEsParaList" class="para-list"></div>
                        <div class="translation-actions" style="margin-top: 8px;">
                            <button class="btn" onclick="prevEnEsParagraph()" style="flex:1;">‚¨ÜÔ∏è Anterior</button>
                            <button class="btn" onclick="nextEnEsParagraph()" style="flex:1;">‚¨áÔ∏è Siguiente</button>
                        </div>

                        <hr>

                        <label><b>Texto original</b></label>
                        <div id="enEsSourceText" class="translation-box"></div>

                        <label style="margin-top: 10px;"><b>Traduccion</b></label>
                        <div id="enEsTranslationText" class="translation-box"></div>
                        <div class="translation-actions" style="margin-top: 8px;">
                            <button class="btn" onclick="playEnEsAudio()" style="flex:1;">üîä Pronunciar</button>
                            <button class="btn" onclick="stopEnEsAudio()" style="flex:1;">‚èπÔ∏è Parar</button>
                        </div>
                        <audio id="enEsAudio" controls style="width: 100%; margin-top: 8px; display:none;"></audio>
                        <div id="enEsStatus" style="font-size: 0.8rem; color: var(--text-muted);"></div>
                    </div>

                    <div class="viewer-wrap">
                        <div id="enEsWrapper" style="position: relative;">
                            <canvas id="enEsCanvas" style="display:block; border: 1px solid black;"></canvas>
                            <div id="enEsTextLayer" class="textLayer"></div>
                            <canvas id="enEsOcrLayer" class="ocr-layer"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TRANSLATE ES -> EN TAB -->
            <div id="translate-es-en" class="tab-content full-height">
                <div class="side-layout">
                    <div class="sidebar-controls">
                        <h3>Espa√±ol ‚Üí Ingles</h3>

                        <button class="btn" style="width:100%; margin-bottom:10px;"
                            onclick="document.getElementById('esEnFileInput').click()">
                            üìÇ Cargar PDF
                        </button>
                        <input type="file" id="esEnFileInput" accept="application/pdf" style="display: none;"
                            onchange="handleEsEnFileBase(this)">

                        <hr>

                        <div style="display:flex; gap:5px; margin-bottom: 10px;">
                            <button class="btn" style="flex:1; font-size: 0.8rem;" onclick="setEsEnZoom('fit')">Ajustar
                                Ancho</button>
                            <button class="btn" style="width: 30px;" onclick="changeEsEnZoom(0.2)">+</button>
                            <button class="btn" style="width: 30px;" onclick="changeEsEnZoom(-0.2)">-</button>
                        </div>

                        <div style="display:flex; gap:5px; margin-bottom: 10px;">
                            <button class="btn" style="flex:1;" onclick="changeEsEnPage(-1)">‚èÆÔ∏è Pagina</button>
                            <button class="btn" style="flex:1;" onclick="changeEsEnPage(1)">Pagina ‚è≠Ô∏è</button>
                        </div>
                        <div id="esEnPageLabel" style="font-size: 0.85rem; color: var(--text-muted);">1 / 1</div>

                        <hr>

                        <button class="btn" onclick="runEsEnOcrCurrentPage()" style="background:#0f766e;">
                            üîé OCR esta pagina
                        </button>

                        <hr>

                        <label><b>Parrafos</b></label>
                        <div id="esEnParaList" class="para-list"></div>
                        <div class="translation-actions" style="margin-top: 8px;">
                            <button class="btn" onclick="prevEsEnParagraph()" style="flex:1;">‚¨ÜÔ∏è Anterior</button>
                            <button class="btn" onclick="nextEsEnParagraph()" style="flex:1;">‚¨áÔ∏è Siguiente</button>
                        </div>

                        <hr>

                        <label><b>Texto original</b></label>
                        <div id="esEnSourceText" class="translation-box"></div>

                        <label style="margin-top: 10px;"><b>Traduccion</b></label>
                        <div id="esEnTranslationText" class="translation-box"></div>
                        <div class="translation-actions" style="margin-top: 8px;">
                            <button class="btn" onclick="playEsEnAudio()" style="flex:1;">üîä Pronunciar</button>
                            <button class="btn" onclick="stopEsEnAudio()" style="flex:1;">‚èπÔ∏è Parar</button>
                        </div>
                        <audio id="esEnAudio" controls style="width: 100%; margin-top: 8px; display:none;"></audio>
                        <div id="esEnStatus" style="font-size: 0.8rem; color: var(--text-muted);"></div>
                    </div>

                    <div class="viewer-wrap">
                        <div id="esEnWrapper" style="position: relative;">
                            <canvas id="esEnCanvas" style="display:block; border: 1px solid black;"></canvas>
                            <div id="esEnTextLayer" class="textLayer"></div>
                            <canvas id="esEnOcrLayer" class="ocr-layer"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PODCAST TAB -->
            <div id="podcast" class="tab-content full-height">
                <div class="side-layout">
                    <div class="sidebar-controls">
                        <h3>Podcast Studio</h3>

                        <button class="btn" style="width:100%; margin-bottom:10px;"
                            onclick="document.getElementById('podcastFileInput').click()">
                            üìÇ Cargar PDF
                        </button>
                        <input type="file" id="podcastFileInput" accept="application/pdf" style="display: none;"
                            onchange="handlePodcastFileBase(this)">

                        <hr>

                        <label><b>1. Grabadora</b></label>
                        <div
                            style="text-align:center; border: 1px solid #ccc; padding: 10px; border-radius: 5px; background: white;">
                            <canvas id="audioVisualizer" width="200" height="50"
                                style="width:100%; height:50px; background:#222; margin-bottom:5px;"></canvas>
                            <div id="recordTimer" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 5px;">00:00
                            </div>

                            <div style="display:flex; gap:5px; justify-content: center;">
                                <button id="btnRecordStart" class="btn" onclick="startRecording()"
                                    style="background: #d32f2f; color: white;">üî¥ Grabar</button>
                                <button id="btnRecordStop" class="btn" onclick="stopRecording()" disabled>‚èπÔ∏è Parar</button>
                            </div>
                        </div>

                        <div id="audioPreviewContainer" style="margin-top: 10px; display:none;">
                            <label>Pre-escucha:</label>
                            <audio id="audioPreview" controls style="width: 100%;"></audio>
                            <button class="btn" onclick="useRecordedAudio()"
                                style="width:100%; margin-top:5px; background:#4CAF50; color:white;">‚úÖ Usar Audio</button>
                        </div>

                        <hr>
                        <label><b>O subir archivo:</b></label>
                        <input type="file" id="uploadAudioInput" accept="audio/*" onchange="handleAudioUpload(this)">

                        <hr>
                        <label><b>2. Insertar</b></label>
                        <p style="font-size:0.8rem; color:#666;">El audio se adjuntar√° al PDF. Haz clic en "Colocar" y luego
                            en la p√°gina para a√±adir el icono.</p>
                        <button id="btnPlacePodcast" class="btn" disabled onclick="activatePodcastPlacement()">üìç Colocar en
                            PDF</button>

                        <hr>
                        <button id="btnSavePodcast" class="btn" disabled onclick="savePodcastPDF()">üíæ Guardar PDF</button>

                    </div>

                    <div class="viewer-wrap">
                        <div id="podcastWrapper" style="position: relative;">
                            <canvas id="podcastCanvas"
                                style="display:block; border: 1px solid black; cursor: default;"></canvas>
                        </div>
                    </div>
                </div>

                <div class="floating-controls">
                    <button onclick="changePodcastPage(-1)">‚èÆÔ∏è</button>
                    <span id="podcastPageLabel">1 / 1</span>
                    <button onclick="changePodcastPage(1)">‚è≠Ô∏è</button>
                </div>
            </div>

            <!-- TTS PODCAST TAB -->
            <div id="tts-podcast" class="tab-content full-height">
                <div class="side-layout">
                    <div class="sidebar-controls">
                        <h3>Texto a Podcast</h3>

                        <button class="btn" style="width:100%; margin-bottom:10px;"
                            onclick="document.getElementById('ttsPodcastFileInput').click()">
                            üìÇ Cargar PDF
                        </button>
                        <input type="file" id="ttsPodcastFileInput" accept="application/pdf" style="display: none;"
                            onchange="handleTTSPodcastFileBase(this)">

                        <hr>

                        <label><b>1. Texto:</b></label>
                        <textarea id="ttsInputText" rows="6" class="form-control"
                            placeholder="Escribe aqu√≠ el texto para convertir a audio..."></textarea>

                        <label>Idioma:</label>
                        <select id="ttsLang" class="form-control">
                            <option value="es">Espa√±ol</option>
                            <option value="en">Ingl√©s</option>
                            <option value="fr">Franc√©s</option>
                            <option value="de">Alem√°n</option>
                        </select>

                        <button class="btn" onclick="generateTTSAudio()"
                            style="margin-top:10px; background:#673ab7; color:white;">
                            üîä Generar Audio
                        </button>

                        <div id="ttsAudioPreviewContainer" style="margin-top: 10px; display:none;">
                            <label>Pre-escucha:</label>
                            <audio id="ttsAudioPreview" controls style="width: 100%;"></audio>
                        </div>

                        <hr>
                        <label><b>2. Insertar</b></label>
                        <p style="font-size:0.8rem; color:#666;">Haz clic en "Colocar" y luego selecciona el lugar en el
                            PDF.</p>
                        <button id="btnPlaceTTSPodcast" class="btn" disabled onclick="activateTTSPodcastPlacement()">
                            üìç Colocar en PDF
                        </button>

                        <hr>
                        <button id="btnSaveTTSPodcast" class="btn" disabled onclick="saveTTSPodcastPDF()">
                            üíæ Guardar PDF
                        </button>

                    </div>

                    <div class="viewer-wrap">
                        <div id="ttsPodcastWrapper" style="position: relative;">
                            <canvas id="ttsPodcastCanvas"
                                style="display:block; border: 1px solid black; cursor: default;"></canvas>
                        </div>
                    </div>
                </div>

                <div class="floating-controls">
                    <button onclick="changeTTSPodcastPage(-1)">‚èÆÔ∏è</button>
                    <span id="ttsPodcastPageLabel">1 / 1</span>
                    <button onclick="changeTTSPodcastPage(1)">‚è≠Ô∏è</button>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL FOR ANNOTATION -->
    <div id="annotationModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>

            <div class="toolbar">
                <div class="toolbar-group" id="annotationTools">
                    <button class="tool-btn active" onclick="setTool('cursor')" id="btnToolCursor"
                        title="Cursor (Mover)">üñ±Ô∏è</button>
                    <button class="tool-btn" onclick="setTool('highlight')" id="btnToolHighlight"
                        title="Resaltar">üñçÔ∏è</button>
                    <button class="tool-btn" onclick="setTool('underline')" id="btnToolUnderline"
                        title="Subrayar">UÃ≤</button>
                    <button class="tool-btn" onclick="setTool('strikethrough')" id="btnToolStrike"
                        title="Tachar">SÃ∂</button>
                    <button class="tool-btn" onclick="setTool('text')" id="btnToolText" title="Texto">T</button>
                    <button class="tool-btn" onclick="setTool('note')" id="btnToolNote" title="Nota">üìù</button>
                    <button class="tool-btn" onclick="setTool('arrow')" id="btnToolArrow" title="Flecha">‚ûú</button>
                    <button class="tool-btn" onclick="setTool('rectangle')" id="btnToolRect"
                        title="Rect√°ngulo">‚ñ≠</button>
                    <button class="tool-btn" onclick="setTool('circle')" id="btnToolCircle"
                        title="C√≠rculo">‚≠ï</button>
                    <button class="tool-btn" onclick="setTool('draw')" id="btnToolDraw" title="Dibujar">‚úèÔ∏è</button>
                    <button class="tool-btn" onclick="setTool('eraser')" id="btnToolEraser"
                        title="Borrador (Clic en anotaci√≥n)">üßπ</button>
                </div>

                <div class="toolbar-group" id="mediaTools" style="display:none;">
                    <button class="tool-btn active" onclick="setTool('cursor')" id="btnToolCursorMedia"
                        title="Cursor">üñ±Ô∏è</button>
                    <button class="tool-btn" onclick="setTool('youtube')" id="btnToolYouTube"
                        title="Video YouTube">üì∫
                        Video</button>
                    <button class="tool-btn" onclick="setTool('audio')" id="btnToolAudio" title="Audio Link">üîä
                        Audio</button>
                    <button class="tool-btn" onclick="setTool('link')" id="btnToolLink" title="Enlace Web">üîó
                        Enlace</button>
                    <button class="tool-btn" onclick="setTool('eraser')" id="btnToolEraserMedia"
                        title="Borrador">üßπ</button>
                </div>
                <div class="toolbar-group">
                    <label style="margin:0; font-size:0.85rem;">Color:</label>
                    <input type="color" id="toolColor" value="#ffeb3b" class="color-picker">
                    <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:2px;">
                        <button class="tool-btn" onclick="setQuickColor('#ffeb3b')"
                            style="background:#ffeb3b; width:20px; height:20px; padding:0;"
                            title="Amarillo"></button>
                        <button class="tool-btn" onclick="setQuickColor('#ff6b6b')"
                            style="background:#ff6b6b; width:20px; height:20px; padding:0;" title="Rojo"></button>
                        <button class="tool-btn" onclick="setQuickColor('#4ecdc4')"
                            style="background:#4ecdc4; width:20px; height:20px; padding:0;" title="Azul"></button>
                        <button class="tool-btn" onclick="setQuickColor('#95e1d3')"
                            style="background:#95e1d3; width:20px; height:20px; padding:0;" title="Verde"></button>
                        <button class="tool-btn" onclick="setQuickColor('#a78bfa')"
                            style="background:#a78bfa; width:20px; height:20px; padding:0;" title="Morado"></button>
                        <button class="tool-btn" onclick="setQuickColor('#fb923c')"
                            style="background:#fb923c; width:20px; height:20px; padding:0;"
                            title="Naranja"></button>
                        <button class="tool-btn" onclick="setQuickColor('#000000')"
                            style="background:#000000; width:20px; height:20px; padding:0;" title="Negro"></button>
                        <button class="tool-btn" onclick="setQuickColor('#ffffff')"
                            style="background:#ffffff; border:1px solid #ccc; width:20px; height:20px; padding:0;"
                            title="Blanco"></button>
                    </div>
                </div>
                <div class="toolbar-group">
                    <label style="margin:0; font-size:0.85rem;">Fuente:</label>
                    <select id="toolFont" style="font-size:0.85rem; padding:4px; width: 100px;">
                        <option value="Helvetica">Helvetica</option>
                        <option value="Helvetica-Bold">Helvetica Bold</option>
                        <option value="Helvetica-Oblique">Helvetica Italic</option>
                        <option value="Helvetica-BoldOblique">Helvetica Bold Italic</option>
                        <option value="Times-Roman">Times</option>
                        <option value="Times-Bold">Times Bold</option>
                        <option value="Times-Italic">Times Italic</option>
                        <option value="Times-BoldItalic">Times Bold Italic</option>
                        <option value="Courier">Courier</option>
                        <option value="Courier-Bold">Courier Bold</option>
                        <option value="Courier-Oblique">Courier Italic</option>
                        <option value="Courier-BoldOblique">Courier Bold Italic</option>
                    </select>
                    <select id="toolSize" style="font-size:0.85rem; padding:4px; width:50px;" title="Tama√±o Texto">
                        <option value="8">8pt</option>
                        <option value="10">10pt</option>
                        <option value="12" selected>12pt</option>
                        <option value="14">14pt</option>
                        <option value="16">16pt</option>
                        <option value="18">18pt</option>
                        <option value="24">24pt</option>
                        <option value="32">32pt</option>
                    </select>
                    <select id="toolWidth" style="font-size:0.85rem; padding:4px; width:70px;" title="Grosor L√≠nea">
                        <option value="1">Fino</option>
                        <option value="2" selected>Normal</option>
                        <option value="4">Grueso</option>
                        <option value="8">Marcador</option>
                    </select>
                </div>
                <div class="toolbar-group">
                    <input type="number" id="pageNumberInput" value="1" min="1"
                        style="width: 50px; text-align: center; padding: 4px; margin: 0 5px;"
                        onchange="jumpToPage(this.value)">
                    <span id="pageTotalLabel" style="font-size:0.9rem;">/ 1</span>
                    <button class="tool-btn" onclick="changePage(1)" title="P√°gina siguiente">‚è≠Ô∏è</button>
                </div>
                <div class="toolbar-group">
                    <button class="tool-btn" onclick="undoAnnotation()" title="Deshacer"
                        style="font-weight:bold;">‚Ü∂</button>
                    <button class="tool-btn" onclick="clearPageAnnotations()" title="Limpiar p√°gina"
                        style="color:#ef4444;">üóëÔ∏è</button>
                </div>
                <div class="toolbar-group" style="margin-left:auto;">
                    <button class="tool-btn" style="background:#dbeafe; color:#1e40af; border-color:#93c5fd;"
                        onclick="saveAnnotations()">üíæ Guardar PDF</button>
                    <button class="tool-btn" style="background:#fee2e2; color:#ef4444; border-color:#fca5a5;"
                        onclick="closeModal()">Cerrar</button>
                </div>
            </div>

            <div id="pdfViewerContainer">
                <div id="pageContainer">
                    <canvas id="pdfCanvas"></canvas>
                    <canvas id="annotationLayer"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js" defer></script>
    <script src="JS/common.js" defer></script>
    <script src="JS/tabs/merge.js" defer></script>
    <script src="JS/tabs/extract.js" defer></script>
    <script src="JS/tabs/search.js" defer></script>
    <script src="JS/tabs/chapters.js" defer></script>
    <script src="JS/tabs/unlock.js" defer></script>
    <script src="JS/tabs/annotate.js" defer></script>
    <script src="JS/tabs/media.js" defer></script>
    <script src="JS/tabs/translate.js" defer></script>
    <script src="JS/tabs/translate-en-es.js" defer></script>
    <script src="JS/tabs/translate-es-en.js" defer></script>
    <script src="JS/tabs/podcast.js" defer></script>
    <script src="JS/tabs/tts-podcast.js" defer></script>
</body>

</html>
